<!DOCTYPE html>
<html lang="fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÅ D√©tecteur de chemins de fichiers trop long</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0b2675 0%, #4383F5 50%, #49BEFA 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #061C5E 0%,  #2A5DB7 50%,#1E6EB0 100% );
            box-shadow: 0 15px 50px rgba(6, 28, 94, 0.6);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: #0D2979;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #102050;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #47ABF8;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #22b8b5;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #38a169;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .status.info {
            background: #bee3f8;
            color: #2c5282;
            border-left: 4px solid #3182ce;
        }

        .folder-info {
            background: linear-gradient(135deg, rgba(21, 42, 104, 0.05) 0%, rgba(38, 208, 206, 0.05) 100%);
            padding: 18px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #0D2979;
            display: none;
            box-shadow: 0 4px 15px rgba(38, 208, 206, 0.15);
            backdrop-filter: blur(10px);
            animation: slideInUp 0.4s ease;
        }

        .folder-icon {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .folder-path {
            font-size: 0.9em;
            color: #4A5568;
            font-family: 'Courier New', monospace;
            margin-left: 10px;
            background: rgba(255, 255, 255, 0.7);
            padding: 4px 8px;
            border-radius: 4px;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0D2979 0%, #47ABF8 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 13px;
        }

        .results-container {
            display: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #0D2979;
        }

        .stat-card.warning {
            border-left-color: #47ABF8;
        }

        .stat-card.danger {
            border-left-color: #47ABF8;
        }

        .stat-label {
            font-size: 13px;
            color: #718096;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #2d3748;
        }

        .virtual-table {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .table-header {
            display: grid;
            grid-template-columns: 100px 120px 180px 1fr;
            background: #f7fafc;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #cbd5e0;
        }

        .table-row {
            display: grid;
            grid-template-columns: 100px 120px 180px 1fr;
            border-bottom: 1px solid #e2e8f0;
                }

        .table-row:hover {
            background: #f7fafc;
        }

        .table-cell {
            padding: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .length-cell {
            font-weight: bold;
            color: #464E5E;
        }

        .excess-cell {
            color: #464E5E;
            font-weight: 500;
        }

        .path-cell {
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 6px;
        }

        .pagination-info {
            font-size: 14px;
            color: #4a5568;
        }

        .pagination-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            display: none;
        }

        .no-results-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .no-results h2 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .no-results p {
            color: #718096;
        }

        .initial-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .initial-loading-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .initial-loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #e2e8f0;
            border-top-color: #0D2979;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .initial-loading-text {
            margin-top: 20px;
            font-size: 16px;
            color: #4a5568;
            font-weight: 500;
        }

        select {
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .rename-btn {
            padding: 8px;
            font-size: 14px;
        }

        .sev-icon {
            margin-right: 8px;
        }


        .length-cell.warning {
            color: #464E5E;
        }

        .length-cell.critical {
            color: #464E5E;
        }
        .copyright-footer {
    text-align: center;
    padding: 20px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    font-weight: 500;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(6, 28, 94, 0.9));
    backdrop-filter: blur(10px);
    z-index: 1000;
    box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.3);
}

.copyright-footer p {
    margin: 0;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

    </style>
</head>

<body>
    <div class="initial-loading-overlay" id="initialLoadingOverlay" style="display: none;">
        <div class="initial-loading-content">
            <div class="initial-loading-spinner"></div>
            <div class="initial-loading-text">Pr√©paration du dossier...</div>
            <p style="margin-top: 10px; color: #718096; font-size: 14px;">
                Le navigateur charge les informations des fichiers.<br>Veuillez patienter quelques instants.
            </p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üîß D√©tecteur de chemins de fichiers trop long</h1>
            <p>D√©tectez les chemins de fichiers d√©passant 255 caract√®res</p>
        </div>

        <div class="content">
            <div class="controls">


                <div class="file-input-wrapper">
                    <input type="file" id="folderInput" webkitdirectory="" directory="" multiple="">
                    <button class="btn btn-primary" id="selectFolderBtn">üîç S√©lectionner un dossier √† analyser</button>
                </div>
                <button class="btn btn-secondary" id="exportBtn">üì• Exporter CSV</button>
            </div>

           <div class="folder-info" id="folderInfo" style="display: block;">
                <strong><span class="folder-icon">üìÅ</span> Dossier s√©lectionn√© :</strong>
                <span id="folderName">OneDrive - Osalyd Consulting</span>
                <span id="folderPath" class="folder-path" style="display: none;"></span>
            </div>

             

            <div class="loading" id="loading" style="display: none;">
                <div id="loadingText">Analyse de 2‚ÄØ106 fichiers...</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 100%;">100% (2‚ÄØ106 / 2‚ÄØ106)</div>
                </div>
            </div>

            <div class="results-container" id="resultsContainer" style="display: block;">
                <div class="stats-grid">
                    <div class="stat-card danger">
                        <div class="stat-label">Fichiers probl√©matiques</div>
                        <div class="stat-value" id="resultsCount">1</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Longueur max d√©tect√©e</div>
                        <div class="stat-value" id="maxLength">267</div>
                    </div>
                </div>

                <div class="status error" id="status" style="display: block;">‚ö†Ô∏è 1 chemin(s) d√©passent 255 caract√®res sur 2‚ÄØ106 fichiers analys√©s.</div>

                <div class="virtual-table" id="virtualTable">
                    <div class="table-header">
                        <div class="table-cell">Longueur</div>
                        <div class="table-cell">Caract√®res en trop</div>
                        <div class="table-cell">Actions</div>
                        <div class="table-cell">Chemin complet</div>
                    </div>
                    <div id="resultsBody"><div class="table-row">
            <div class="table-cell length-cell warning">
                <span class="sev-icon">üü°</span>267
            </div>
            <div class="table-cell excess-cell">
                +12
                
            </div>
            <div class="table-cell">
                <button class="btn btn-primary btn-sm rename-btn" data-path="OneDrive - Osalyd Consulting/OneDrive - Osalyd Consulting/Test dossier long long long long long long long/Test dossier long long long long long long/Test dossier long long long long long long/Test dossier long long long long/Nouveau Document Microsoft Word Nouveau Document Microsoft Word No.docx">
                    üìã Copier le chemin
                </button>
            </div>
            <div class="table-cell path-cell" title="OneDrive - Osalyd Consulting/OneDrive - Osalyd Consulting/Test dossier long long long long long long long/Test dossier long long long long long long/Test dossier long long long long long long/Test dossier long long long long/Nouveau Document Microsoft Word Nouveau Document Microsoft Word No.docx">
                OneDrive - Osalyd Consulting/OneDrive - Osalyd Consulting/Test dossier long long long long long long long/Test dossier long long long long long long/Test dossier long long long long long long/Test dossier long long long long/Nouveau Document Microsoft Word Nouveau Document Microsoft Word No.docx
            </div>
        </div></div>
                </div>

                <div class="pagination">
                    <div class="pagination-info">
                        Affichage de <span id="startRange">1</span> √† <span id="endRange">1</span> sur <span id="totalResults">1</span> r√©sultats
                    </div>
                    <div class="pagination-controls">
                        <select id="pageSize">
                            <option value="50">50 par page</option>
                            <option value="100" selected="">100 par page</option>
                            <option value="200">200 par page</option>
                            <option value="500">500 par page</option>
                        </select>
                        <button class="btn btn-primary" id="prevBtn" disabled="">‚óÄ Pr√©c√©dent</button>
                        <span id="pageInfo">Page 1 / 1</span>
                        <button class="btn btn-primary" id="nextBtn" disabled="">Suivant ‚ñ∂</button>
                    </div>
                </div>
            </div>

            <div class="no-results" id="noResults" style="display: none;">
                <div class="no-results-icon">‚úÖ</div>
                <h2>Tous les chemins de fichiers respectent la limite de 255 caract√®res.</h2>
                <p>Aucun probl√®me d√©tect√© dans ce dossier.</p>
            </div>
        </div>

        <footer class="copyright-footer">
        <p>¬© 2026 Julie BREDECHE - Osalyd Consulting</p>
    </footer>
        
    </div>

    <script>
        let selectedFiles = [];
        let longPathFiles = [];
        let currentPage = 1;
        let pageSize = 100;
        let rootFolderName = '';

        const WARNING_LIMIT = 255;
        const CRITICAL_LIMIT = 400;
        const folderInput = document.getElementById('folderInput');
        const selectFolderBtn = document.getElementById('selectFolderBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const exportBtn = document.getElementById('exportBtn');
        const status = document.getElementById('status');
        const loading = document.getElementById('loading');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsBody = document.getElementById('resultsBody');
        const resultsCount = document.getElementById('resultsCount');
        const maxLength = document.getElementById('maxLength');
        const noResults = document.getElementById('noResults');
        const folderInfo = document.getElementById('folderInfo');
        const folderName = document.getElementById('folderName');
        const loadingText = document.getElementById('loadingText');
        const progressBar = document.getElementById('progressBar');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfo = document.getElementById('pageInfo');
        const pageSizeSelect = document.getElementById('pageSize');
        const startRange = document.getElementById('startRange');
        const endRange = document.getElementById('endRange');
        const totalResults = document.getElementById('totalResults');
        const virtualTable = document.getElementById('virtualTable');
        const initialLoadingOverlay = document.getElementById('initialLoadingOverlay');


        function getSeverity(length) {
            if (length > CRITICAL_LIMIT) return 'critical';
            if (length > WARNING_LIMIT) return 'warning';
            return 'ok';
        }

        // Extraire le nom du dossier racine
        function getRootFolderName(files) {
            if (!files.length) return '';

            const rootFolder = Array.from(files).find(file =>
                file.webkitRelativePath.split('/').length === 1
            );

            if (rootFolder) {
                return rootFolder.webkitRelativePath || rootFolder.name;
            }

            const firstFile = files[0];
            return firstFile.webkitRelativePath.split('/')[0] || 'Dossier inconnu';
        }

        function getRootFolderPath(files) {
            const rootName = getRootFolderName(files);
            return rootName ? `üìÇ ${rootName}` : '';
        }


        folderInput.addEventListener('change', e => {
            const files = Array.from(e.target.files);
            if (!files.length) {
                folderInfo.style.display = 'none';
                return;
            }

            const folderName = getRootFolderName(files);
            rootFolderName = getRootFolderName(files);

            document.getElementById('folderName').textContent = folderName;


            folderInfo.style.display = 'block';

        });


        selectFolderBtn.addEventListener('click', () => {
            initialLoadingOverlay.style.display = 'flex';
            setTimeout(() => {
                folderInput.click();
            }, 100);
        });

        folderInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);

            if (!files.length) {
                initialLoadingOverlay.style.display = 'none';
                return;
            }

            initialLoadingOverlay.style.display = 'none';
            loading.style.display = 'block';
            loadingText.textContent = `Analyse de ${files.length.toLocaleString('fr-FR')} fichiers...`;

            progressBar.style.width = '0%';
            progressBar.textContent = '0%';

            status.style.display = 'none';
            resultsContainer.style.display = 'none';
            noResults.style.display = 'none';

            longPathFiles = [];
            selectedFiles = [];

            const total = files.length;
            let processed = 0;

            const batchSize = 1000;

            const processBatch = () => {
                const end = Math.min(processed + batchSize, total);

                for (let i = processed; i < end; i++) {
                    const file = files[i];
                    selectedFiles.push(file);

                    const fullPath = file.webkitRelativePath || file.name;
                    const length = fullPath.length;

                    const severity = getSeverity(length);

                    if (severity !== 'ok') {
                        const longestSegmentInfo = findLongestSegment(fullPath);

                        longPathFiles.push({
                            path: fullPath,
                            length,
                            severity,                 // 'warning' | 'critical'
                            excess255: length - WARNING_LIMIT,     // toujours calcul√© vs 255
                            excess400: Math.max(0, length - CRITICAL_LIMIT), // utile si critical
                            longestSegment: longestSegmentInfo.segment,
                            longestSegmentLength: longestSegmentInfo.length
                        });
                    }

                }

                processed = end;

                const progress = Math.round((processed / total) * 100);
                progressBar.style.width = progress + '%';
                progressBar.textContent =
                    `${progress}% (${processed.toLocaleString('fr-FR')} / ${total.toLocaleString('fr-FR')})`;

                if (processed < total) {
                    requestAnimationFrame(processBatch);
                } else {
                    finishAnalysis();
                }
            };

            setTimeout(processBatch, 100);
        });

        function finishAnalysis() {
            loading.style.display = 'none';

            const total = selectedFiles.length;

            if (!longPathFiles.length) {
                noResults.style.display = 'block';
                showStatus(
                    'success',
                    `‚úÖ Analyse termin√©e : aucun chemin ne d√©passe 255 caract√®res sur ${total.toLocaleString('fr-FR')} fichiers.`
                );
                exportBtn.disabled = true;
                return;
            }

            currentPage = 1;
            displayResults();

            const max = Math.max(...longPathFiles.map(f => f.length));
            const avg = Math.round(
                longPathFiles.reduce((sum, f) => sum + f.excess, 0) / longPathFiles.length
            );

            maxLength.textContent = max;

            showStatus(
                'error',
                `‚ö†Ô∏è ${longPathFiles.length.toLocaleString('fr-FR')} chemin(s) d√©passent 255 caract√®res sur ${total.toLocaleString('fr-FR')} fichiers analys√©s.`
            );

            exportBtn.disabled = false;
        }



        exportBtn.addEventListener('click', () => {
            exportToCSV();
        });

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayResults();
            }
        });

        nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(longPathFiles.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                displayResults();
            }
        });

        pageSizeSelect.addEventListener('change', (e) => {
            pageSize = parseInt(e.target.value);
            currentPage = 1;
            displayResults();
        });

        function showStatus(type, message) {
            status.className = `status ${type}`;
            status.textContent = message;
            status.style.display = 'block';
        }

        function findLongestSegment(path) {
            const segments = path.split('/');
            let longestSegment = '';
            let maxSegmentLength = 0;

            segments.forEach(segment => {
                if (segment.length > maxSegmentLength) {
                    maxSegmentLength = segment.length;
                    longestSegment = segment;
                }
            });

            return { segment: longestSegment, length: maxSegmentLength };
        }



        function getParentFolderPath(path) {
            const normalized = String(path).replaceAll('\\', '/');      // unify
            const parent = normalized.replace(/\/[^\/]+$/, '');         // drop filename
            return parent.replaceAll('/', '\\');                        // back to Windows
        }

        function buildRootFolderPath(parentFolderWinPath) {
            // Si parentFolderWinPath est d√©j√† la racine, retourne rootFolderName
            // Sinon, construit chemin relatif depuis la racine
            if (!rootFolderName) return parentFolderWinPath;
            
            const relativePath = parentFolderWinPath 
                ? `${rootFolderName}\\${parentFolderWinPath}` 
                : rootFolderName;
            
            return relativePath;
        }


        function displayResults() {
    resultsBody.innerHTML = '';
    resultsCount.textContent = longPathFiles.length.toLocaleString('fr-FR');
    totalResults.textContent = longPathFiles.length.toLocaleString('fr-FR');
    
    longPathFiles.sort((a, b) => b.length - a.length);
    const totalPages = Math.ceil(longPathFiles.length / pageSize);
    const startIndex = (currentPage - 1) * pageSize;
    const endIndex = Math.min(startIndex + pageSize, longPathFiles.length);
    
    startRange.textContent = (startIndex + 1).toLocaleString('fr-FR');
    endRange.textContent = endIndex.toLocaleString('fr-FR');
    pageInfo.textContent = `Page ${currentPage} / ${totalPages}`;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
    
    const pageFiles = longPathFiles.slice(startIndex, endIndex);
    const fragment = document.createDocumentFragment();
    
    pageFiles.forEach(file => {
        const sevIcon = file.severity === 'critical' ? 'üî¥' : 
                       file.severity === 'warning' ? 'üü°' : '';
        
        // ‚úÖ NOUVEAU : Chemin avec pr√©fixe dossier racine
        const displayPath = rootFolderName 
            ? `${rootFolderName}/${file.path}`
            : file.path;
        
        const row = document.createElement('div');
        row.className = 'table-row';
        row.innerHTML = `
            <div class="table-cell length-cell ${file.severity}">
                ${sevIcon ? `<span class="sev-icon">${sevIcon}</span>` : ''}${file.length}
            </div>
            <div class="table-cell excess-cell">
                ${file.excess255 > 0 ? `+${file.excess255}` : 'OK'}
                ${file.severity === 'critical' ? ` (+${file.excess400})` : ''}
            </div>
            <div class="table-cell">
                <button class="btn btn-primary btn-sm rename-btn" data-path="${displayPath}">
                    üìã Copier le chemin
                </button>
            </div>
            <div class="table-cell path-cell" title="${displayPath}">
                ${displayPath}
            </div>
        `;
        
        const renameBtn = row.querySelector('.rename-btn');
        renameBtn.addEventListener('click', e => {
            e.stopPropagation();
            const path = renameBtn.getAttribute('data-path');
            navigator.clipboard.writeText(path).then(() => {
                showStatus('info', `‚úÖ Chemin du dossier copi√© : ${rootFolderName}/${path.substring(0, 50)}...`);
            }).catch(() => {
                alert(`Impossible de copier le chemin du dossier : ${path}`);
            });
        });
        
        fragment.appendChild(row);
    });
    
    resultsBody.appendChild(fragment);
    virtualTable.scrollTop = 0;
    resultsContainer.style.display = 'block';
}

        async function exportToCSV() {
            try {
                const csv = [
                    ['S√©v√©rit√©', 'Longueur', 'Exc√©dent vs 255', 'Exc√©dent vs 400', 'Segment le plus long', 'Longueur du segment', 'Chemin'],
                    ...longPathFiles.map(f => [f.severity, f.length, f.excess255, f.excess400, f.longestSegment, f.longestSegmentLength, f.path])
                ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });

                if ('showSaveFilePicker' in window) {
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                    const handle = await window.showSaveFilePicker({
                        suggestedName: `chemins_longs_${timestamp}.csv`,
                        types: [{
                            description: 'Fichier CSV',
                            accept: { 'text/csv': ['.csv'] }
                        }]
                    });

                    const writable = await handle.createWritable();
                    await writable.write(blob);
                    await writable.close();

                    showStatus('success', 'Export CSV r√©ussi ! Le fichier a √©t√© enregistr√© √† l\'emplacement choisi.');
                } else {
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                    link.href = URL.createObjectURL(blob);
                    link.download = `chemins_longs_${timestamp}.csv`;
                    link.click();

                    showStatus('success', 'Export CSV r√©ussi ! Le fichier a √©t√© t√©l√©charg√© dans votre dossier de t√©l√©chargements.');
                }
            } catch (err) {
                if (err.name !== 'AbortError') {
                    showStatus('error', 'Erreur lors de l\'export : ' + err.message);
                }
            }
        }
    </script>


</body></html>